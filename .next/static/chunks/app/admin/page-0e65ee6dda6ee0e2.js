(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{221:function(e,s,t){Promise.resolve().then(t.bind(t,8615))},8615:function(e,s,t){"use strict";t.r(s),t.d(s,{UserContext:function(){return u},default:function(){return m},useUserContext:function(){return h}});var l=t(9268),n=t(6006);t(7690);var a=()=>(0,l.jsx)("header",{children:(0,l.jsx)("div",{className:"container",children:(0,l.jsxs)("div",{className:"content",children:[(0,l.jsx)("a",{href:"/",className:"logo",children:"City Group Almaty"}),(0,l.jsx)("div",{className:"navbar",children:(0,l.jsx)(u.Consumer,{children:e=>e.user&&e.user.email&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"user",children:e.user.email}),(0,l.jsx)("div",{className:"btn",onClick:s=>{s.preventDefault(),e.logout()},children:"Выход"})]})})}),(0,l.jsx)("i",{className:"menu",onClick:e=>{e.preventDefault(),setShowMenu(!0)}})]})})});t(6054);var i=t(4214),c=()=>{let[e,s]=(0,n.useState)("new"),[t,a]=(0,n.useState)(""),[c,r]=(0,n.useState)(null),[d,o]=(0,n.useState)([]),u=async s=>{r(null);let{data:t}=await i.Z.get("/api/applications?status=".concat("new"===e?"new":"","&search=").concat(s),{validateStatus:function(e){return!0},headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept"}});r(t),o([])},h=async s=>{r(null);let{data:t}=await i.Z.patch("/api/applications?status=".concat("new"===e?"new":"","&search=").concat(s),d,{validateStatus:function(e){return!0},headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept"}});r(t),o([])};(0,n.useEffect)(()=>{c||u(t)},[c]),(0,n.useEffect)(()=>{c&&(a(""),u(""))},[e]);let m=e=>{d.includes(e)?o(d.filter(s=>s!=e)):o([...d,e])},x=e=>new Date(e).toLocaleDateString("kz-ru"),j=e=>new Date(e).toLocaleTimeString("kz-ru",{hour:"2-digit",minute:"2-digit"});return(0,l.jsx)("div",{id:"table",children:(0,l.jsx)("div",{className:"container",children:(0,l.jsxs)("div",{className:"content",children:[(0,l.jsxs)("div",{className:"filter",children:[(0,l.jsxs)("div",{className:"sort",children:[(0,l.jsx)("div",{className:"sort-item ".concat("all"===e?"active":""),onClick:e=>{e.preventDefault(),s("all")},children:"Все заявки"}),(0,l.jsx)("div",{className:"sort-item ".concat("new"===e?"active":""),onClick:e=>{e.preventDefault(),s("new")},children:"Новые"})]}),(0,l.jsxs)("form",{className:"search-wrapper",onSubmit:e=>{e.preventDefault(),u(t)},children:[(0,l.jsxs)("div",{className:"search",children:[(0,l.jsx)("i",{}),(0,l.jsx)("input",{type:"text",placeholder:"Поиск",onChange:e=>{e.preventDefault(),a(e.currentTarget.value)},value:t})]}),(0,l.jsx)("input",{className:"btn",type:"submit",value:"Найти"})]})]}),(0,l.jsxs)("div",{className:"select-nav",children:[(0,l.jsx)("div",{className:"btn",onClick:e=>{e.preventDefault();let s=[];c&&c.length>0&&c.forEach(e=>{s.push(e._id)}),o(s)},children:"Выделить все"}),(0,l.jsxs)("div",{children:["Выделено: ",d.length]}),(0,l.jsx)("div",{className:"btn",onClick:e=>{e.preventDefault(),d&&d.length>0&&h(t)},children:"Отметить как прочитанное"}),(0,l.jsx)("div",{className:"btn",onClick:e=>{e.preventDefault(),o([])},children:"Снять все выделения"})]}),(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Имя"}),(0,l.jsx)("th",{children:"Телефон"}),(0,l.jsx)("th",{children:"Адрес"}),(0,l.jsx)("th",{children:"ОСИ/ПТ"}),(0,l.jsx)("th",{children:"Дата"}),(0,l.jsx)("th",{children:"Время"})]})}),(0,l.jsx)("tbody",{children:c&&c.length>0&&c.map((e,s)=>(0,l.jsxs)("tr",{className:d.includes(e._id)?"selected":"",onClick:s=>{s.preventDefault(),m(e._id)},children:[(0,l.jsx)("td",{children:e.name}),(0,l.jsx)("td",{children:e.phone}),(0,l.jsx)("td",{children:e.address}),(0,l.jsx)("td",{className:"center",children:e.osi?"есть":"нет"}),(0,l.jsx)("td",{className:"center",children:x(e.createdAt)}),(0,l.jsx)("td",{className:"center",children:j(e.createdAt)})]},s))})]}),c?0===c.length&&(0,l.jsx)("div",{className:"none",children:"Нет данных"}):(0,l.jsx)("div",{className:"loading",children:(0,l.jsx)("i",{})})]})})})};t(980);let r={email:"",password:""};var d=()=>{let{login:e}=h(),[s,t]=(0,n.useState)(r),[a,c]=(0,n.useState)(""),[d,u]=(0,n.useState)(!1),m=async()=>{try{let{data:t,status:l}=await i.Z.put("/api/users",s,{validateStatus:function(e){return!0},headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept"}});console.log(l),200===l?e(t):404===l?c("Неправильно введен логин или пароль"):c("Что-то пошло не так, попробуйте еще раз")}catch(e){console.log(e),c("Что-то пошло не так, попробуйте еще раз")}},x=e=>{e.preventDefault();let l=e.currentTarget.value,n=e.currentTarget.name;t({...s,[n]:l}),c("")};return(0,l.jsxs)("div",{id:"login",children:[(0,l.jsx)(o,{mail:s.email,show:d,setShow:u}),(0,l.jsxs)("div",{className:"content",children:[(0,l.jsx)("i",{className:"logo"}),(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=null;s.email&&s.password||(t="Заполните объязательные поля"),t?c(t):m()},children:[(0,l.jsxs)("div",{className:"inputs",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Логин или email"}),(0,l.jsx)("input",{type:"text",name:"email",value:s.email,onChange:x})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Пароль"}),(0,l.jsx)("input",{type:"password",name:"password",value:s.password,onChange:x}),(0,l.jsx)("div",{className:"error",children:a})]})]}),(0,l.jsxs)("div",{className:"bottom",children:[(0,l.jsx)("div",{className:"forgot",onClick:e=>{e.preventDefault(),u(!0)},children:"Забыли пароль?"}),(0,l.jsx)("input",{type:"submit",className:"btn",value:"Войти"})]})]})]})]})};let o=e=>{let{mail:s,show:t,setShow:a}=e,[i,c]=(0,n.useState)(null),[r,d]=(0,n.useState)(s),o=async e=>{e.preventDefault(),c("loading"),r&&/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(r)&&c("success")},u=e=>{c(null),a(!1)};if(t)return(0,l.jsx)("div",{id:"forgotPassword",children:(0,l.jsxs)("div",{className:"content",children:[!i&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"text",children:[(0,l.jsx)("div",{className:"title",children:"Забыли пароль?"}),(0,l.jsx)("div",{className:"description",children:"Введите привязанную электронную почту и нажмите на кнопку “Сбросить пароль”. Мы отправим на вашу почту ссылку для сброса пароля."})]}),(0,l.jsx)("input",{type:"email",name:"email",placeholder:"E-mail",onChange:e=>{e.preventDefault(),d(e.currentTarget.value)},value:r}),(0,l.jsxs)("div",{className:"bottom",children:[(0,l.jsx)("div",{className:"close",onClick:u,children:"Закрыть"}),(0,l.jsx)("div",{className:"btn",onClick:o,children:"Сбросить пароль"})]})]}),i&&"loading"===i&&(0,l.jsx)("div",{className:"loading",children:(0,l.jsx)("i",{})}),i&&"success"===i&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"text",children:(0,l.jsxs)("div",{className:"description",children:["Новый пароль отправлен на почту ",r]})}),(0,l.jsx)("div",{className:"bottom",children:(0,l.jsx)("div",{className:"btn",onClick:u,children:"Закрыть"})})]})]})})},u=n.createContext(),h=()=>(0,n.useContext)(u);function m(){let[e,s]=(0,n.useState)(null),[t,i]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(!e&&localStorage.getItem("userdata")){let e=JSON.parse(localStorage.getItem("userdata"));s(e.user),i(e.token)}},[e]),(0,l.jsx)(u.Provider,{value:{user:e,login:e=>{s(e.user),i(e.token),localStorage.setItem("userdata",JSON.stringify(e))},logout:()=>{s(null),i(null),localStorage.removeItem("userdata")}},children:e&&e.email?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a,{}),(0,l.jsx)("main",{children:(0,l.jsx)(c,{})})]}):(0,l.jsx)(d,{})})}},7690:function(){},980:function(){},6054:function(){}},function(e){e.O(0,[348,253,769,744],function(){return e(e.s=221)}),_N_E=e.O()}]);